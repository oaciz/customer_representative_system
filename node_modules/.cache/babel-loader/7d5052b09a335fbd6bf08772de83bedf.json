{"ast":null,"code":"var _jsxFileName = \"/Users/macbook/Desktop/demo/src/VideoCall.js\";\nimport React, { useRef, useEffect, useState } from 'react';\nimport { db } from './firebase';\nimport { collection, addDoc, onSnapshot, setDoc, doc, getDoc } from 'firebase/firestore';\nconst VideoCall = () => {\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const [pc, setPc] = useState(null);\n  const [callId, setCallId] = useState('');\n  useEffect(() => {\n    const servers = {\n      iceServers: [{\n        urls: 'stun:stun.l.google.com:19302'\n      }]\n    };\n    const peerConnection = new RTCPeerConnection(servers);\n    setPc(peerConnection);\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      localVideoRef.current.srcObject = stream;\n      stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n    }).catch(error => {\n      console.error('Error accessing media devices.', error);\n    });\n    peerConnection.ontrack = event => {\n      remoteVideoRef.current.srcObject = event.streams[0];\n    };\n    peerConnection.onicecandidate = event => {\n      if (event.candidate) {\n        const candidate = event.candidate.toJSON();\n        if (callId) {\n          addDoc(collection(db, 'calls', callId, 'offerCandidates'), candidate);\n        }\n      }\n    };\n    return () => {\n      peerConnection.close();\n    };\n  }, [callId]);\n  const createOffer = async () => {\n    const callDoc = doc(collection(db, 'calls'));\n    setCallId(callDoc.id);\n    const offerDescription = await pc.createOffer();\n    await pc.setLocalDescription(offerDescription);\n    const offer = {\n      sdp: offerDescription.sdp,\n      type: offerDescription.type\n    };\n    await setDoc(callDoc, {\n      offer\n    });\n    onSnapshot(callDoc, snapshot => {\n      const data = snapshot.data();\n      if ((data === null || data === void 0 ? void 0 : data.answer) && !pc.currentRemoteDescription) {\n        const answerDescription = new RTCSessionDescription(data.answer);\n        pc.setRemoteDescription(answerDescription);\n      }\n    });\n    onSnapshot(collection(callDoc, 'answerCandidates'), snapshot => {\n      snapshot.docChanges().forEach(change => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          pc.addIceCandidate(candidate);\n        }\n      });\n    });\n  };\n  const answerCall = async callId => {\n    const callDoc = doc(db, 'calls', callId);\n    const callData = (await getDoc(callDoc)).data();\n    const offerDescription = callData.offer;\n    await pc.setRemoteDescription(new RTCSessionDescription(offerDescription));\n    const answerDescription = await pc.createAnswer();\n    await pc.setLocalDescription(answerDescription);\n    const answer = {\n      sdp: answerDescription.sdp,\n      type: answerDescription.type\n    };\n    await setDoc(callDoc, {\n      answer\n    });\n    onSnapshot(collection(callDoc, 'offerCandidates'), snapshot => {\n      snapshot.docChanges().forEach(change => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          pc.addIceCandidate(candidate);\n        }\n      });\n    });\n    onSnapshot(collection(callDoc, 'answerCandidates'), snapshot => {\n      snapshot.docChanges().forEach(change => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          pc.addIceCandidate(candidate);\n        }\n      });\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }\n  }, \"Video G\\xF6r\\xFC\\u015Fmesi\"), /*#__PURE__*/React.createElement(\"video\", {\n    ref: localVideoRef,\n    autoPlay: true,\n    muted: true,\n    width: \"400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"video\", {\n    ref: remoteVideoRef,\n    autoPlay: true,\n    width: \"400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: createOffer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  }, \"G\\xF6r\\xFC\\u015Fme Ba\\u015Flat\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"G\\xF6r\\xFC\\u015Fme ID\",\n    onChange: e => setCallId(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => answerCall(callId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }, \"G\\xF6r\\xFC\\u015Fmeye Kat\\u0131l\")));\n};\nexport default VideoCall;","map":{"version":3,"names":["React","useRef","useEffect","useState","db","collection","addDoc","onSnapshot","setDoc","doc","getDoc","VideoCall","localVideoRef","remoteVideoRef","pc","setPc","callId","setCallId","servers","iceServers","urls","peerConnection","RTCPeerConnection","navigator","mediaDevices","getUserMedia","video","audio","then","stream","current","srcObject","getTracks","forEach","track","addTrack","catch","error","console","ontrack","event","streams","onicecandidate","candidate","toJSON","close","createOffer","callDoc","id","offerDescription","setLocalDescription","offer","sdp","type","snapshot","data","answer","currentRemoteDescription","answerDescription","RTCSessionDescription","setRemoteDescription","docChanges","change","RTCIceCandidate","addIceCandidate","answerCall","callData","createAnswer","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","muted","width","onClick","placeholder","onChange","e","target","value"],"sources":["/Users/macbook/Desktop/demo/src/VideoCall.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport { db } from './firebase';\nimport { collection, addDoc, onSnapshot, setDoc, doc, getDoc } from 'firebase/firestore';\n\nconst VideoCall = () => {\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const [pc, setPc] = useState(null);\n  const [callId, setCallId] = useState('');\n\n  useEffect(() => {\n    const servers = {\n      iceServers: [\n        {\n          urls: 'stun:stun.l.google.com:19302',\n        },\n      ],\n    };\n\n    const peerConnection = new RTCPeerConnection(servers);\n    setPc(peerConnection);\n\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        localVideoRef.current.srcObject = stream;\n        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n      })\n      .catch((error) => {\n        console.error('Error accessing media devices.', error);\n      });\n\n    peerConnection.ontrack = (event) => {\n      remoteVideoRef.current.srcObject = event.streams[0];\n    };\n\n    peerConnection.onicecandidate = (event) => {\n      if (event.candidate) {\n        const candidate = event.candidate.toJSON();\n        if (callId) {\n          addDoc(collection(db, 'calls', callId, 'offerCandidates'), candidate);\n        }\n      }\n    };\n\n    return () => {\n      peerConnection.close();\n    };\n  }, [callId]);\n\n  const createOffer = async () => {\n    const callDoc = doc(collection(db, 'calls'));\n    setCallId(callDoc.id);\n\n    const offerDescription = await pc.createOffer();\n    await pc.setLocalDescription(offerDescription);\n\n    const offer = {\n      sdp: offerDescription.sdp,\n      type: offerDescription.type,\n    };\n\n    await setDoc(callDoc, { offer });\n\n    onSnapshot(callDoc, (snapshot) => {\n      const data = snapshot.data();\n      if (data?.answer && !pc.currentRemoteDescription) {\n        const answerDescription = new RTCSessionDescription(data.answer);\n        pc.setRemoteDescription(answerDescription);\n      }\n    });\n\n    onSnapshot(collection(callDoc, 'answerCandidates'), (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          pc.addIceCandidate(candidate);\n        }\n      });\n    });\n  };\n\n  const answerCall = async (callId) => {\n    const callDoc = doc(db, 'calls', callId);\n    const callData = (await getDoc(callDoc)).data();\n\n    const offerDescription = callData.offer;\n    await pc.setRemoteDescription(new RTCSessionDescription(offerDescription));\n\n    const answerDescription = await pc.createAnswer();\n    await pc.setLocalDescription(answerDescription);\n\n    const answer = {\n      sdp: answerDescription.sdp,\n      type: answerDescription.type,\n    };\n\n    await setDoc(callDoc, { answer });\n\n    onSnapshot(collection(callDoc, 'offerCandidates'), (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          pc.addIceCandidate(candidate);\n        }\n      });\n    });\n\n    onSnapshot(collection(callDoc, 'answerCandidates'), (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          pc.addIceCandidate(candidate);\n        }\n      });\n    });\n  };\n\n  return (\n    <div>\n      <h2>Video Görüşmesi</h2>\n      <video ref={localVideoRef} autoPlay muted width=\"400\" />\n      <video ref={remoteVideoRef} autoPlay width=\"400\" />\n      <div>\n        <button onClick={createOffer}>Görüşme Başlat</button>\n        <input type=\"text\" placeholder=\"Görüşme ID\" onChange={(e) => setCallId(e.target.value)} />\n        <button onClick={() => answerCall(callId)}>Görüşmeye Katıl</button>\n      </div>\n    </div>\n  );\n};\n\nexport default VideoCall;"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC1D,SAASC,EAAE,QAAQ,YAAY;AAC/B,SAASC,UAAU,EAAEC,MAAM,EAAEC,UAAU,EAAEC,MAAM,EAAEC,GAAG,EAAEC,MAAM,QAAQ,oBAAoB;AAExF,MAAMC,SAAS,GAAGA,CAAA,KAAM;EACtB,MAAMC,aAAa,GAAGX,MAAM,CAAC,IAAI,CAAC;EAClC,MAAMY,cAAc,GAAGZ,MAAM,CAAC,IAAI,CAAC;EACnC,MAAM,CAACa,EAAE,EAAEC,KAAK,CAAC,GAAGZ,QAAQ,CAAC,IAAI,CAAC;EAClC,MAAM,CAACa,MAAM,EAAEC,SAAS,CAAC,GAAGd,QAAQ,CAAC,EAAE,CAAC;EAExCD,SAAS,CAAC,MAAM;IACd,MAAMgB,OAAO,GAAG;MACdC,UAAU,EAAE,CACV;QACEC,IAAI,EAAE;MACR,CAAC;IAEL,CAAC;IAED,MAAMC,cAAc,GAAG,IAAIC,iBAAiB,CAACJ,OAAO,CAAC;IACrDH,KAAK,CAACM,cAAc,CAAC;IAErBE,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;MAAEC,KAAK,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAK,CAAC,CAAC,CAC9DC,IAAI,CAAEC,MAAM,IAAK;MAChBjB,aAAa,CAACkB,OAAO,CAACC,SAAS,GAAGF,MAAM;MACxCA,MAAM,CAACG,SAAS,CAAC,CAAC,CAACC,OAAO,CAACC,KAAK,IAAIb,cAAc,CAACc,QAAQ,CAACD,KAAK,EAAEL,MAAM,CAAC,CAAC;IAC7E,CAAC,CAAC,CACDO,KAAK,CAAEC,KAAK,IAAK;MAChBC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;IACxD,CAAC,CAAC;IAEJhB,cAAc,CAACkB,OAAO,GAAIC,KAAK,IAAK;MAClC3B,cAAc,CAACiB,OAAO,CAACC,SAAS,GAAGS,KAAK,CAACC,OAAO,CAAC,CAAC,CAAC;IACrD,CAAC;IAEDpB,cAAc,CAACqB,cAAc,GAAIF,KAAK,IAAK;MACzC,IAAIA,KAAK,CAACG,SAAS,EAAE;QACnB,MAAMA,SAAS,GAAGH,KAAK,CAACG,SAAS,CAACC,MAAM,CAAC,CAAC;QAC1C,IAAI5B,MAAM,EAAE;UACVV,MAAM,CAACD,UAAU,CAACD,EAAE,EAAE,OAAO,EAAEY,MAAM,EAAE,iBAAiB,CAAC,EAAE2B,SAAS,CAAC;QACvE;MACF;IACF,CAAC;IAED,OAAO,MAAM;MACXtB,cAAc,CAACwB,KAAK,CAAC,CAAC;IACxB,CAAC;EACH,CAAC,EAAE,CAAC7B,MAAM,CAAC,CAAC;EAEZ,MAAM8B,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,MAAMC,OAAO,GAAGtC,GAAG,CAACJ,UAAU,CAACD,EAAE,EAAE,OAAO,CAAC,CAAC;IAC5Ca,SAAS,CAAC8B,OAAO,CAACC,EAAE,CAAC;IAErB,MAAMC,gBAAgB,GAAG,MAAMnC,EAAE,CAACgC,WAAW,CAAC,CAAC;IAC/C,MAAMhC,EAAE,CAACoC,mBAAmB,CAACD,gBAAgB,CAAC;IAE9C,MAAME,KAAK,GAAG;MACZC,GAAG,EAAEH,gBAAgB,CAACG,GAAG;MACzBC,IAAI,EAAEJ,gBAAgB,CAACI;IACzB,CAAC;IAED,MAAM7C,MAAM,CAACuC,OAAO,EAAE;MAAEI;IAAM,CAAC,CAAC;IAEhC5C,UAAU,CAACwC,OAAO,EAAGO,QAAQ,IAAK;MAChC,MAAMC,IAAI,GAAGD,QAAQ,CAACC,IAAI,CAAC,CAAC;MAC5B,IAAI,CAAAA,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEC,MAAM,KAAI,CAAC1C,EAAE,CAAC2C,wBAAwB,EAAE;QAChD,MAAMC,iBAAiB,GAAG,IAAIC,qBAAqB,CAACJ,IAAI,CAACC,MAAM,CAAC;QAChE1C,EAAE,CAAC8C,oBAAoB,CAACF,iBAAiB,CAAC;MAC5C;IACF,CAAC,CAAC;IAEFnD,UAAU,CAACF,UAAU,CAAC0C,OAAO,EAAE,kBAAkB,CAAC,EAAGO,QAAQ,IAAK;MAChEA,QAAQ,CAACO,UAAU,CAAC,CAAC,CAAC5B,OAAO,CAAE6B,MAAM,IAAK;QACxC,IAAIA,MAAM,CAACT,IAAI,KAAK,OAAO,EAAE;UAC3B,MAAMV,SAAS,GAAG,IAAIoB,eAAe,CAACD,MAAM,CAACrD,GAAG,CAAC8C,IAAI,CAAC,CAAC,CAAC;UACxDzC,EAAE,CAACkD,eAAe,CAACrB,SAAS,CAAC;QAC/B;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC;EAED,MAAMsB,UAAU,GAAG,MAAOjD,MAAM,IAAK;IACnC,MAAM+B,OAAO,GAAGtC,GAAG,CAACL,EAAE,EAAE,OAAO,EAAEY,MAAM,CAAC;IACxC,MAAMkD,QAAQ,GAAG,CAAC,MAAMxD,MAAM,CAACqC,OAAO,CAAC,EAAEQ,IAAI,CAAC,CAAC;IAE/C,MAAMN,gBAAgB,GAAGiB,QAAQ,CAACf,KAAK;IACvC,MAAMrC,EAAE,CAAC8C,oBAAoB,CAAC,IAAID,qBAAqB,CAACV,gBAAgB,CAAC,CAAC;IAE1E,MAAMS,iBAAiB,GAAG,MAAM5C,EAAE,CAACqD,YAAY,CAAC,CAAC;IACjD,MAAMrD,EAAE,CAACoC,mBAAmB,CAACQ,iBAAiB,CAAC;IAE/C,MAAMF,MAAM,GAAG;MACbJ,GAAG,EAAEM,iBAAiB,CAACN,GAAG;MAC1BC,IAAI,EAAEK,iBAAiB,CAACL;IAC1B,CAAC;IAED,MAAM7C,MAAM,CAACuC,OAAO,EAAE;MAAES;IAAO,CAAC,CAAC;IAEjCjD,UAAU,CAACF,UAAU,CAAC0C,OAAO,EAAE,iBAAiB,CAAC,EAAGO,QAAQ,IAAK;MAC/DA,QAAQ,CAACO,UAAU,CAAC,CAAC,CAAC5B,OAAO,CAAE6B,MAAM,IAAK;QACxC,IAAIA,MAAM,CAACT,IAAI,KAAK,OAAO,EAAE;UAC3B,MAAMV,SAAS,GAAG,IAAIoB,eAAe,CAACD,MAAM,CAACrD,GAAG,CAAC8C,IAAI,CAAC,CAAC,CAAC;UACxDzC,EAAE,CAACkD,eAAe,CAACrB,SAAS,CAAC;QAC/B;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFpC,UAAU,CAACF,UAAU,CAAC0C,OAAO,EAAE,kBAAkB,CAAC,EAAGO,QAAQ,IAAK;MAChEA,QAAQ,CAACO,UAAU,CAAC,CAAC,CAAC5B,OAAO,CAAE6B,MAAM,IAAK;QACxC,IAAIA,MAAM,CAACT,IAAI,KAAK,OAAO,EAAE;UAC3B,MAAMV,SAAS,GAAG,IAAIoB,eAAe,CAACD,MAAM,CAACrD,GAAG,CAAC8C,IAAI,CAAC,CAAC,CAAC;UACxDzC,EAAE,CAACkD,eAAe,CAACrB,SAAS,CAAC;QAC/B;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC;EAED,oBACE3C,KAAA,CAAAoE,aAAA;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACE1E,KAAA,CAAAoE,aAAA;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAI,4BAAmB,CAAC,eACxB1E,KAAA,CAAAoE,aAAA;IAAOO,GAAG,EAAE/D,aAAc;IAACgE,QAAQ;IAACC,KAAK;IAACC,KAAK,EAAC,KAAK;IAAAT,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAAE,CAAC,eACxD1E,KAAA,CAAAoE,aAAA;IAAOO,GAAG,EAAE9D,cAAe;IAAC+D,QAAQ;IAACE,KAAK,EAAC,KAAK;IAAAT,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAAE,CAAC,eACnD1E,KAAA,CAAAoE,aAAA;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACE1E,KAAA,CAAAoE,aAAA;IAAQW,OAAO,EAAEjC,WAAY;IAAAuB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,gCAAsB,CAAC,eACrD1E,KAAA,CAAAoE,aAAA;IAAOf,IAAI,EAAC,MAAM;IAAC2B,WAAW,EAAC,uBAAY;IAACC,QAAQ,EAAGC,CAAC,IAAKjE,SAAS,CAACiE,CAAC,CAACC,MAAM,CAACC,KAAK,CAAE;IAAAf,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAAE,CAAC,eAC1F1E,KAAA,CAAAoE,aAAA;IAAQW,OAAO,EAAEA,CAAA,KAAMd,UAAU,CAACjD,MAAM,CAAE;IAAAqD,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,iCAAuB,CAC/D,CACF,CAAC;AAEV,CAAC;AAED,eAAe/D,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module"}