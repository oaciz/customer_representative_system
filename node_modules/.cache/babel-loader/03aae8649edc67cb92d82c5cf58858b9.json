{"ast":null,"code":"var _jsxFileName = \"/Users/macbook/Desktop/demo/src/VideoCall.js\";\nimport React, { useRef, useEffect, useState } from 'react';\nimport { db } from './firebase';\nimport { collection, addDoc, onSnapshot, setDoc, doc, getDoc, query, where } from 'firebase/firestore';\nimport { useHistory } from 'react-router-dom';\nconst VideoCall = () => {\n  const history = useHistory();\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const [pc, setPc] = useState(null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const [incomingCall, setIncomingCall] = useState(null);\n  useEffect(() => {\n    console.log('Current User:', currentUser);\n    const checkAuth = async () => {\n      const loggedInUser = localStorage.getItem('currentUser');\n      if (!loggedInUser) {\n        alert('Lütfen önce giriş yapın!');\n        history.push('/login');\n        return;\n      }\n      const user = JSON.parse(loggedInUser);\n      setCurrentUser(user);\n      console.log('Giriş yapan kullanıcı:', user);\n\n      // Kullanıcıyı çevrimiçi olarak işaretle\n      const userStatusRef = doc(db, 'userStatus', user.email);\n      await setDoc(userStatusRef, {\n        online: true,\n        lastSeen: new Date().toISOString(),\n        email: user.email\n      });\n\n      // Kullanıcı çıkış yaptığında offline yap\n      window.addEventListener('beforeunload', async () => {\n        await setDoc(userStatusRef, {\n          online: false,\n          lastSeen: new Date().toISOString(),\n          email: user.email\n        });\n      });\n    };\n    checkAuth();\n    const initializeApp = async () => {\n      try {\n        const loggedInUser = localStorage.getItem('currentUser');\n        if (!loggedInUser) {\n          history.push('/login');\n          return;\n        }\n        const user = JSON.parse(loggedInUser);\n        setCurrentUser(user);\n\n        // Kullanıcı durumunu güncelle\n        if (user === null || user === void 0 ? void 0 : user.email) {\n          const userStatusRef = doc(db, 'userStatus', user.email);\n          await setDoc(userStatusRef, {\n            online: true,\n            lastSeen: new Date().toISOString(),\n            email: user.email\n          });\n        }\n      } catch (error) {\n        console.error('Initialize error:', error);\n      }\n    };\n    initializeApp();\n\n    // Çevrimiçi kullanıcıları dinle\n    const q = query(collection(db, 'userStatus'), where('online', '==', true));\n    const unsubscribe = onSnapshot(q, snapshot => {\n      const users = [];\n      snapshot.forEach(doc => {\n        if (doc.data().email !== (currentUser === null || currentUser === void 0 ? void 0 : currentUser.email)) {\n          users.push(doc.data());\n        }\n      });\n      setOnlineUsers(users);\n      console.log('Çevrimiçi kullanıcılar:', users);\n    });\n\n    // Gelen aramaları dinle\n    const callsQuery = query(collection(db, 'calls'), where('targetUser', '==', currentUser === null || currentUser === void 0 ? void 0 : currentUser.email), where('status', '==', 'pending'));\n    const callsUnsubscribe = onSnapshot(callsQuery, snapshot => {\n      snapshot.forEach(doc => {\n        setIncomingCall({\n          id: doc.id,\n          ...doc.data()\n        });\n        console.log('Gelen çağrı:', doc.data());\n      });\n    });\n    return () => {\n      if (currentUser === null || currentUser === void 0 ? void 0 : currentUser.email) {\n        const userStatusRef = doc(db, 'userStatus', currentUser.email);\n        setDoc(userStatusRef, {\n          online: false,\n          lastSeen: new Date().toISOString(),\n          email: currentUser.email\n        });\n      }\n    };\n  }, []);\n  ;\n\n  // WebRTC kurulumu\n  const setupWebRTC = async () => {\n    try {\n      console.log('WebRTC kurulumu başlatılıyor...');\n      const servers = {\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      };\n      const peerConnection = new RTCPeerConnection(servers);\n      setPc(peerConnection);\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true\n      });\n      localVideoRef.current.srcObject = stream;\n      stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n      peerConnection.ontrack = event => {\n        remoteVideoRef.current.srcObject = event.streams[0];\n      };\n      console.log('WebRTC kurulumu tamamlandı');\n      return peerConnection;\n    } catch (error) {\n      console.error('WebRTC kurulumu sırasında hata:', error);\n    }\n  };\n  const callUser = async targetUser => {\n    const peerConnection = await setupWebRTC();\n    const callDoc = doc(collection(db, 'calls'));\n    const offerCandidates = collection(callDoc, 'offerCandidates');\n    const answerCandidates = collection(callDoc, 'answerCandidates');\n    peerConnection.onicecandidate = event => {\n      if (event.candidate) {\n        addDoc(offerCandidates, event.candidate.toJSON());\n      }\n    };\n    const offerDescription = await peerConnection.createOffer();\n    await peerConnection.setLocalDescription(offerDescription);\n    await setDoc(callDoc, {\n      offer: {\n        sdp: offerDescription.sdp,\n        type: offerDescription.type\n      },\n      createdBy: currentUser.email,\n      targetUser: targetUser.email,\n      status: 'pending',\n      createdAt: new Date().toISOString()\n    });\n    onSnapshot(callDoc, snapshot => {\n      const data = snapshot.data();\n      if ((data === null || data === void 0 ? void 0 : data.answer) && !peerConnection.currentRemoteDescription) {\n        const answerDescription = new RTCSessionDescription(data.answer);\n        peerConnection.setRemoteDescription(answerDescription);\n      }\n    });\n    onSnapshot(answerCandidates, snapshot => {\n      snapshot.docChanges().forEach(change => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          peerConnection.addIceCandidate(candidate);\n        }\n      });\n    });\n  };\n  const answerCall = async () => {\n    if (!incomingCall) return;\n    const peerConnection = await setupWebRTC();\n    const callDoc = doc(db, 'calls', incomingCall.id);\n    const answerCandidates = collection(callDoc, 'answerCandidates');\n    const offerCandidates = collection(callDoc, 'offerCandidates');\n    peerConnection.onicecandidate = event => {\n      if (event.candidate) {\n        addDoc(answerCandidates, event.candidate.toJSON());\n      }\n    };\n    const callData = (await getDoc(callDoc)).data();\n    const offerDescription = callData.offer;\n    await peerConnection.setRemoteDescription(new RTCSessionDescription(offerDescription));\n    const answerDescription = await peerConnection.createAnswer();\n    await peerConnection.setLocalDescription(answerDescription);\n    await setDoc(callDoc, {\n      answer: {\n        sdp: answerDescription.sdp,\n        type: answerDescription.type\n      },\n      status: 'answered'\n    }, {\n      merge: true\n    });\n    onSnapshot(offerCandidates, snapshot => {\n      snapshot.docChanges().forEach(change => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          peerConnection.addIceCandidate(candidate);\n        }\n      });\n    });\n    setIncomingCall(null);\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }\n  }, \"Video G\\xF6r\\xFC\\u015Fmesi\"), currentUser && /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 23\n    }\n  }, \"Kullan\\u0131c\\u0131: \", currentUser.email), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 9\n    }\n  }, \"\\xC7evrimi\\xE7i Kullan\\u0131c\\u0131lar\"), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 9\n    }\n  }, onlineUsers.map(user => /*#__PURE__*/React.createElement(\"li\", {\n    key: user.email,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 13\n    }\n  }, user.email, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => callUser(user),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 15\n    }\n  }, \"Ara\"))))), incomingCall && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 11\n    }\n  }, incomingCall.createdBy, \" ar\\u0131yor...\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: answerCall,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 11\n    }\n  }, \"Cevapla\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setIncomingCall(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 11\n    }\n  }, \"Reddet\")), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: localVideoRef,\n    autoPlay: true,\n    muted: true,\n    width: \"400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"video\", {\n    ref: remoteVideoRef,\n    autoPlay: true,\n    width: \"400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 9\n    }\n  })));\n};\nexport default VideoCall;","map":{"version":3,"names":["React","useRef","useEffect","useState","db","collection","addDoc","onSnapshot","setDoc","doc","getDoc","query","where","useHistory","VideoCall","history","localVideoRef","remoteVideoRef","pc","setPc","currentUser","setCurrentUser","onlineUsers","setOnlineUsers","incomingCall","setIncomingCall","console","log","checkAuth","loggedInUser","localStorage","getItem","alert","push","user","JSON","parse","userStatusRef","email","online","lastSeen","Date","toISOString","window","addEventListener","initializeApp","error","q","unsubscribe","snapshot","users","forEach","data","callsQuery","callsUnsubscribe","id","setupWebRTC","servers","iceServers","urls","peerConnection","RTCPeerConnection","stream","navigator","mediaDevices","getUserMedia","video","audio","current","srcObject","getTracks","track","addTrack","ontrack","event","streams","callUser","targetUser","callDoc","offerCandidates","answerCandidates","onicecandidate","candidate","toJSON","offerDescription","createOffer","setLocalDescription","offer","sdp","type","createdBy","status","createdAt","answer","currentRemoteDescription","answerDescription","RTCSessionDescription","setRemoteDescription","docChanges","change","RTCIceCandidate","addIceCandidate","answerCall","callData","createAnswer","merge","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","map","key","onClick","ref","autoPlay","muted","width"],"sources":["/Users/macbook/Desktop/demo/src/VideoCall.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport { db } from './firebase';\nimport { collection, addDoc, onSnapshot, setDoc, doc, getDoc, query, where } from 'firebase/firestore';\nimport { useHistory } from 'react-router-dom';\n\nconst VideoCall = () => {\n  const history = useHistory();\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const [pc, setPc] = useState(null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const [incomingCall, setIncomingCall] = useState(null);\n\n  useEffect(() => {\n    console.log('Current User:', currentUser);\n    const checkAuth = async () => {\n      const loggedInUser = localStorage.getItem('currentUser');\n      if (!loggedInUser) {\n        alert('Lütfen önce giriş yapın!');\n        history.push('/login');\n        return;\n      }\n      const user = JSON.parse(loggedInUser);\n      setCurrentUser(user);\n      console.log('Giriş yapan kullanıcı:', user);\n\n      // Kullanıcıyı çevrimiçi olarak işaretle\n      const userStatusRef = doc(db, 'userStatus', user.email);\n      await setDoc(userStatusRef, { \n        online: true,\n        lastSeen: new Date().toISOString(),\n        email: user.email\n      });\n\n      // Kullanıcı çıkış yaptığında offline yap\n      window.addEventListener('beforeunload', async () => {\n        await setDoc(userStatusRef, { \n          online: false,\n          lastSeen: new Date().toISOString(),\n          email: user.email\n        });\n      });\n    };\n    \n    checkAuth();\n    const initializeApp = async () => {\n      try {\n        const loggedInUser = localStorage.getItem('currentUser');\n        if (!loggedInUser) {\n          history.push('/login');\n          return;\n        }\n\n        const user = JSON.parse(loggedInUser);\n        setCurrentUser(user);\n\n        // Kullanıcı durumunu güncelle\n        if (user?.email) {\n          const userStatusRef = doc(db, 'userStatus', user.email);\n          await setDoc(userStatusRef, {\n            online: true,\n            lastSeen: new Date().toISOString(),\n            email: user.email\n          });\n        }\n      } catch (error) {\n        console.error('Initialize error:', error);\n      }\n    };\n\n    initializeApp();\n\n    // Çevrimiçi kullanıcıları dinle\n    const q = query(collection(db, 'userStatus'), where('online', '==', true));\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const users = [];\n      snapshot.forEach((doc) => {\n        if (doc.data().email !== currentUser?.email) {\n          users.push(doc.data());\n        }\n      });\n      setOnlineUsers(users);\n      console.log('Çevrimiçi kullanıcılar:', users);\n    });\n\n    // Gelen aramaları dinle\n    const callsQuery = query(\n      collection(db, 'calls'), \n      where('targetUser', '==', currentUser?.email),\n      where('status', '==', 'pending')\n    );\n    \n    const callsUnsubscribe = onSnapshot(callsQuery, (snapshot) => {\n      snapshot.forEach((doc) => {\n        setIncomingCall({\n          id: doc.id,\n          ...doc.data()\n        });\n        console.log('Gelen çağrı:', doc.data());\n      });\n    });\n\n    return () => {\n      if (currentUser?.email) {\n        const userStatusRef = doc(db, 'userStatus', currentUser.email);\n        setDoc(userStatusRef, {\n          online: false,\n          lastSeen: new Date().toISOString(),\n          email: currentUser.email\n        });\n      }\n    };\n  },[]); ;\n\n  // WebRTC kurulumu\n  const setupWebRTC = async () => {\n    try {\n      console.log('WebRTC kurulumu başlatılıyor...');\n      const servers = {\n        iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],\n      };\n\n      const peerConnection = new RTCPeerConnection(servers);\n      setPc(peerConnection);\n\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n      localVideoRef.current.srcObject = stream;\n      stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));\n      \n      peerConnection.ontrack = (event) => {\n        remoteVideoRef.current.srcObject = event.streams[0];\n      };\n\n      console.log('WebRTC kurulumu tamamlandı');\n      return peerConnection;\n    } catch (error) {\n      console.error('WebRTC kurulumu sırasında hata:', error);\n    }\n  };\n\n  const callUser = async (targetUser) => {\n    const peerConnection = await setupWebRTC();\n    \n    const callDoc = doc(collection(db, 'calls'));\n    const offerCandidates = collection(callDoc, 'offerCandidates');\n    const answerCandidates = collection(callDoc, 'answerCandidates');\n\n    peerConnection.onicecandidate = (event) => {\n      if (event.candidate) {\n        addDoc(offerCandidates, event.candidate.toJSON());\n      }\n    };\n\n    const offerDescription = await peerConnection.createOffer();\n    await peerConnection.setLocalDescription(offerDescription);\n\n    await setDoc(callDoc, {\n      offer: {\n        sdp: offerDescription.sdp,\n        type: offerDescription.type,\n      },\n      createdBy: currentUser.email,\n      targetUser: targetUser.email,\n      status: 'pending',\n      createdAt: new Date().toISOString()\n    });\n\n    onSnapshot(callDoc, (snapshot) => {\n      const data = snapshot.data();\n      if (data?.answer && !peerConnection.currentRemoteDescription) {\n        const answerDescription = new RTCSessionDescription(data.answer);\n        peerConnection.setRemoteDescription(answerDescription);\n      }\n    });\n\n    onSnapshot(answerCandidates, (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          peerConnection.addIceCandidate(candidate);\n        }\n      });\n    });\n  };\n\n  const answerCall = async () => {\n    if (!incomingCall) return;\n\n    const peerConnection = await setupWebRTC();\n    const callDoc = doc(db, 'calls', incomingCall.id);\n    const answerCandidates = collection(callDoc, 'answerCandidates');\n    const offerCandidates = collection(callDoc, 'offerCandidates');\n\n    peerConnection.onicecandidate = (event) => {\n      if (event.candidate) {\n        addDoc(answerCandidates, event.candidate.toJSON());\n      }\n    };\n\n    const callData = (await getDoc(callDoc)).data();\n    const offerDescription = callData.offer;\n    await peerConnection.setRemoteDescription(new RTCSessionDescription(offerDescription));\n\n    const answerDescription = await peerConnection.createAnswer();\n    await peerConnection.setLocalDescription(answerDescription);\n\n    await setDoc(callDoc, {\n      answer: {\n        sdp: answerDescription.sdp,\n        type: answerDescription.type,\n      },\n      status: 'answered'\n    }, { merge: true });\n\n    onSnapshot(offerCandidates, (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        if (change.type === 'added') {\n          const candidate = new RTCIceCandidate(change.doc.data());\n          peerConnection.addIceCandidate(candidate);\n        }\n      });\n    });\n\n    setIncomingCall(null);\n  };\n\n  return (\n    <div>\n      <h2>Video Görüşmesi</h2>\n      {currentUser && <p>Kullanıcı: {currentUser.email}</p>}\n      \n      <div>\n        <h3>Çevrimiçi Kullanıcılar</h3>\n        <ul>\n          {onlineUsers.map((user) => (\n            <li key={user.email}>\n              {user.email}\n              <button onClick={() => callUser(user)}>Ara</button>\n            </li>\n          ))}\n        </ul>\n      </div>\n\n      {incomingCall && (\n        <div>\n          <p>{incomingCall.createdBy} arıyor...</p>\n          <button onClick={answerCall}>Cevapla</button>\n          <button onClick={() => setIncomingCall(null)}>Reddet</button>\n        </div>\n      )}\n\n      <div>\n        <video ref={localVideoRef} autoPlay muted width=\"400\" />\n        <video ref={remoteVideoRef} autoPlay width=\"400\" />\n      </div>\n    </div>\n  );\n};\n\nexport default VideoCall;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}